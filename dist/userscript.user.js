// ==UserScript==
// @name         Several QoL
// @namespace    http://tampermonkey.net/
// @version      1.1.1
// @description  A userscript for QoL for the Haremverse
// @author       infarcactus
// @license      GPLv3
// @match        https://*.haremheroes.com/*
// @match        https://*.hentaiheroes.com/*
// @match        https://*.gayharem.com/*
// @match        https://*.comixharem.com/*
// @match        https://*.hornyheroes.com/*
// @match        https://*.pornstarharem.com/*
// @match        https://*.transpornstarharem.com/*
// @match        https://*.gaypornstarharem.com/*
// @match        https://www.mangarpg.com/*
// @updateURL    https://github.com/infarcactus-HH/HH-Several_QoL/raw/refs/heads/main/dist/userscript.user.js
// @downloadURL  https://github.com/infarcactus-HH/HH-Several_QoL/raw/refs/heads/main/dist/userscript.user.js
// @grant        GM.addStyle
// @grant        GM.openInTab
// @grant        unsafeWindow
// @run-at       document-end
// ==/UserScript==

"use strict";(()=>{var n=class{constructor(e){this.hasRun=!1;this.group="severalQoL",this.configSchema=e}};var y={baseKey:"popupPlusPlus",label:"<span tooltip='Stacking popups,click on popups to make it disappear'>Popup++</span>",default:!0},u=class extends n{constructor(){super(y)}shouldRun(){return!0}run(){if(this.hasRun||!this.shouldRun())return;this.hasRun=!0,GM.addStyle("#toast-popups {display:inherit!important;}");let e={},t=null;delete shared.general.objectivePopup.show,shared.general.objectivePopup.show=function(o){if(this.LastPoints==null&&(this.LastPoints={}),!(!o.objective_points||o.battle_result)){if(!o.objective_points){let r=o.objective_points;if(Object.keys(this.pointsBox).length)for(let a in r)this.pointsBox[a]?this.pointsBox[a].name===r[a].name&&(this.pointsBox[a].points_gained+=r[a].points_gained):this.pointsBox[a]=r[a];else this.pointsBox=o.objective_points;o?.end?.rewards?.hasOwnProperty("lose")}i(this,o.objective_points)}};function i(o,r){let a=new Set;Object.keys(r).map((l=>{let p=r[l];if(!e[l])e[l]=p,p.points_gained>0&&a.add(l);else{let _=p.points_gained;_>0&&a.add(l),e[l].points_gained+=_}}));let b=$(`<div class="popup_wrapper"><div id="objective_popup" class="popup"><div class="noti_box"><div class="points">${Object.keys(e).map((l=>{let p=e[l];return`<div class="row animate" style="transition: all 20ms;"><div class="contest_name">${p.title}:</div><div class="contest_points"><div class="points_name" style="animation:none;">${p.name}: </div><div class="points_num" style="animation:none;"><div class="points_i" style="animation:none;">+${number_format_lang(p.points_gained)}</div></div></div></div>`})).join("")}</div></div></div></div></div>`);$("#toast-popups .popup_wrapper").remove(),$("#toast-popups").css("display","unset"),$("#toast-popups"),$("#toast-popups").append(b),$("#toast-popups").css("display","unset"),t&&(clearTimeout(t),t=null),t=setTimeout(()=>{b.remove(),t=null,e={}},5e3),b.on("click.removePopup",function(){b.remove(),t=null,e={}})}}};var P={baseKey:"girlsToWiki",label:"Girls to Wiki (HH)",default:!1,subSettings:[{key:"infoBubbleNameToWiki",default:!0,label:"Info bubble name clickable to wiki"},{key:"portraitToWiki",default:!1,label:"Make portrait clickable to wiki"}]},c=class extends n{constructor(){super(P)}shouldRun(){return location.host.includes("heroes")}run(e){this.hasRun||!this.shouldRun()||(this.hasRun=!0,e?.infoBubbleNameToWiki&&setInterval(()=>{S()},500),e?.portraitToWiki&&setInterval(()=>{w()},500))}};function S(){$(".new_girl_info .girl_name_wrap > h5[style!='cursor: pointer;']").each(function(){let s=$(this);s.css("cursor","pointer"),s.on("click.InfoBubbleToWiki",function(){let e=s.attr("hh_title");if(!e)return;let t=e.replace(/ /g,"-");GM.openInTab(`https://harem-battle.club/wiki/Harem-Heroes/HH:${t}`,{active:!0})})})}function w(){$(".slot_girl_shards > [data-new-girl-tooltip][style!='cursor: pointer;']").each(function(){let s=$(this),e=s.attr("data-new-girl-tooltip");if(!e)return;let t=e.match(/"name":"(.+)","rarity/);t&&t[1]&&(s.css("cursor","pointer"),s.on("click.ImgToWiki",function(i){i.stopPropagation();let o=t[1].replace(/ /g,"-");GM.openInTab(`https://harem-battle.club/wiki/Harem-Heroes/HH:${o}`,{active:!0})}))})}var d=class extends n{constructor(){let e={baseKey:"entirePaid",label:"Removes only $ options",default:!1};super(e)}shouldRun(){return!0}run(){this.hasRun||!this.shouldRun()||(this.hasRun=!0,GM.addStyle(".pass_reward.reward_wrapper{display:none!important;}"),GM.addStyle("#gsp_btn_holder{display:none!important;}"),GM.addStyle(".rewards_seasons_row .rewards_pair .tier_number{top:100%!important;}"),GM.addStyle("#get_mega_pass_shop_btn{display:none!important;}"),GM.addStyle("#bundles_tab{display:none!important;}"),GM.addStyle(".purchase-shop{display:none!important;}"))}};var H={baseKey:"tighterPoPs",label:"Tighter PoPs (requires css tweaks for PoP)",default:!0},m=class extends n{constructor(){super(H)}shouldRun(){return location.pathname.includes("/activities.html")}run(){this.hasRun||!this.shouldRun()||(this.hasRun=!0,GM.addStyle("#pop .pop_list .pop-action-btn {margin-bottom: 0.4rem!important;margin-top: 0rem!important;}#pop .pop_list .pop_list_scrolling_area .pop_thumb img {height: 90px!important;}.activities-container #pop .pop_list .pop_list_scrolling_area .pop_thumb_container .pop_thumb_expanded {height: 89px!important;background: linear-gradient(0deg, #00000087, transparent)!important;}.activities-container #pop .pop_list .pop_list_scrolling_area .pop_thumb_container, .activities-container #pop .pop_list .pop_list_scrolling_area .pop_thumb_container .pop_thumb_active {min-height: 89px!important;height: 89px!important;margin-bottom: 5px!important;}.activities-container #pop .pop_list .pop_list_scrolling_area .pop_thumb>.pop_thumb_level {top: -93px!important;}.activities-container #pop .pop_list .pop_list_scrolling_area .pop_thumb.pop_thumb_active[status=pending_reward]>.pop_thumb_space {top: -126px!important;}.activities-container #pop .pop_list .pop_list_scrolling_area .collect_notif {margin-top: -91px!important;margin-left: 121px!important;}.activities-container .pop_thumb_progress_bar {margin-top: 21px!important;}"))}};var x={baseKey:"labyTeamPreset",label:"<span tooltip='Add a button to register laby team presets, and to apply it'>Laby Team Preset</span>",default:!0},h=class extends n{constructor(){super(x);this.savedTeamPresetKey="SeveralQoL_LabyTeamPreset"}shouldRun(){return location.pathname.includes("/edit-labyrinth-team.html")}run(){if(this.hasRun||!this.shouldRun())return;this.hasRun=!0;let t=$(".boss-bang-panel"),i=$('<button class="green_button_L" tooltip="Save preset for later runs">Save Preset</button>');i.on("click",()=>{this.saveCurrentPreset(),o.removeAttr("disabled")}),t.append(i);let o=$(`<button class="green_button_L" tooltip="Use previously saved preset & leave page" ${localStorage.getItem(this.savedTeamPresetKey)?"":"disabled"}>Fill Preset</button>`);o.on("click",()=>{this.loadSavedPreset()}),unsafeWindow.HHPlusPlus.Helpers.doWhenSelectorAvailable(".change-team-panel .player-team .average-lvl",()=>{$(".change-team-panel .player-team .average-lvl").replaceWith(o)})}saveCurrentPreset(){let t=[];$(".team-hexagon .team-member-container").each(function(){let i=$(this).attr("data-team-member-position"),o=$(this).attr("data-girl-id");$(this).is("[data-girl-id]")&&i&&o&&(t[i]=o)}),console.log("Saving preset: ",t),localStorage.setItem(this.savedTeamPresetKey,JSON.stringify(t))}loadSavedPreset(){let t=localStorage.getItem(this.savedTeamPresetKey);if(!t){console.warn("No saved preset found");return}try{let i=JSON.parse(t);console.log("Loading preset: ",i);let o={class:"Hero",action:"edit_team",girls:i,battle_type:"labyrinth",id_team:unsafeWindow.teamId};console.log("AJAX settings: ",o),shared.general.hh_ajax(o,r=>{shared.general.navigate(unsafeWindow.redirectUrl)})}catch(i){console.error("Failed to load preset:",i)}}};var f=class extends n{constructor(){let e={baseKey:"noAnnoyingPopups",label:"Removes annoying popup appearing automaticly for shops, paths, news",default:!1};super(e)}shouldRun(){return!0}run(){this.hasRun||!this.shouldRun()||(this.hasRun=!0,document.cookie="disabledPopups=PassReminder,Bundles,News; path=/")}};var T={baseKey:"whaleBossTournament",label:"Renames WBT to Whale Boss Tournament",default:!1},g=class extends n{constructor(){super(T)}shouldRun(){return location.pathname.includes("/home.html")}run(){this.hasRun||!this.shouldRun()||(this.hasRun=!0,unsafeWindow.HHPlusPlus.Helpers.doWhenSelectorAvailable(".world-boss .title",()=>{$(".world-boss .title").text("Whale Boss Tournament")}))}};var v=class{constructor(){if(unsafeWindow.hhPlusPlusConfig===void 0){$(document).one("hh++-bdsm:loaded",()=>{this.run()});return}this.run()}run(){let e=[new u,new h,new f,new d,new c,new m,new g];unsafeWindow.hhPlusPlusConfig.registerGroup({key:"severalQoL",name:"<span tooltip='by infarctus'>Several QoL</span>"}),e.forEach(t=>{unsafeWindow.hhPlusPlusConfig.registerModule(t)}),unsafeWindow.hhPlusPlusConfig.loadConfig(),unsafeWindow.hhPlusPlusConfig.runModules()}};new v;})();
