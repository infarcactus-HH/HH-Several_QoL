// ==UserScript==
// @name         Several QoL
// @namespace    http://tampermonkey.net/
// @version      1.0.2
// @description  A userscript for QoL for the Haremverse
// @author       infarcactus
// @license      GPLv3
// @match        https://*.haremheroes.com/*
// @match        https://*.hentaiheroes.com/*
// @match        https://*.gayharem.com/*
// @match        https://*.comixharem.com/*
// @match        https://*.hornyheroes.com/*
// @match        https://*.pornstarharem.com/*
// @match        https://*.transpornstarharem.com/*
// @match        https://*.gaypornstarharem.com/*
// @match        https://www.mangarpg.com/*
// @updateURL    https://github.com/infarcactus-HH/HH-Several_QoL/raw/refs/heads/main/dist/userscript.user.js
// @downloadURL  https://github.com/infarcactus-HH/HH-Several_QoL/raw/refs/heads/main/dist/userscript.user.js
// @grant        GM.addStyle
// @grant        GM.openInTab
// @grant        unsafeWindow
// @run-at       document-end
// ==/UserScript==

"use strict";(()=>{var n=class{constructor(t){this.hasRun=!1;this.group="severalQoL",this.configSchema=t}};var v={baseKey:"popupPlusPlus",label:"Popup++",default:!0},u=class extends n{constructor(){super(v)}shouldRun(){return!0}run(){GM.addStyle("#toast-popups {display:inherit!important;}");let t={},e=null;delete shared.general.objectivePopup.show,shared.general.objectivePopup.show=function(o){if(this.LastPoints==null&&(this.LastPoints={}),!(!o.objective_points||o.battle_result)){if(!o.objective_points){let r=o.objective_points;if(Object.keys(this.pointsBox).length)for(let a in r)this.pointsBox[a]?this.pointsBox[a].name===r[a].name&&(this.pointsBox[a].points_gained+=r[a].points_gained):this.pointsBox[a]=r[a];else this.pointsBox=o.objective_points;o?.end?.rewards?.hasOwnProperty("lose")}s(this,o.objective_points)}};function s(o,r){let a=new Set;Object.keys(r).map((l=>{let p=r[l];if(!t[l])t[l]=p,p.points_gained>0&&a.add(l);else{let b=p.points_gained;b>0&&a.add(l),t[l].points_gained+=b}}));let f=$(`<div class="popup_wrapper"><div id="objective_popup" class="popup"><div class="noti_box"><div class="points">${Object.keys(t).map((l=>{let p=t[l];return`<div class="row animate" style="transition: all 20ms;"><div class="contest_name">${p.title}:</div><div class="contest_points"><div class="points_name" style="animation:none;">${p.name}: </div><div class="points_num" style="animation:none;"><div class="points_i" style="animation:none;">+${number_format_lang(p.points_gained)}</div></div></div></div>`})).join("")}</div></div></div></div></div>`);$("#toast-popups .popup_wrapper").remove(),$("#toast-popups").css("display","unset"),$("#toast-popups"),$("#toast-popups").append(f),$("#toast-popups").css("display","unset"),e&&(clearTimeout(e),e=null),e=setTimeout(()=>{f.remove(),e=null,t={}},5e3),f.on("click.removePopup",function(){f.remove(),e=null,t={}})}}};var y={baseKey:"girlsToWiki",label:"Girls to Wiki (HH)",default:!1,subSettings:[{key:"infoBubbleNameToWiki",default:!0,label:"Info bubble name clickable to wiki"},{key:"portraitToWiki",default:!1,label:"Make portrait clickable to wiki"}]},c=class extends n{constructor(){super(y)}shouldRun(){return location.host.includes("heroes")}run(t){this.hasRun||!this.shouldRun()||(this.hasRun=!0,t?.infoBubbleNameToWiki&&setInterval(()=>{P()},500),t?.portraitToWiki&&setInterval(()=>{H()},500))}};function P(){$(".new_girl_info .girl_name_wrap > h5[style!='cursor: pointer;']").each(function(){let i=$(this);i.css("cursor","pointer"),i.on("click.InfoBubbleToWiki",function(){let t=i.attr("hh_title");if(!t)return;let e=t.replace(/ /g,"-");GM.openInTab(`https://harem-battle.club/wiki/Harem-Heroes/HH:${e}`,{active:!0})})})}function H(){$(".slot_girl_shards > [data-new-girl-tooltip][style!='cursor: pointer;']").each(function(){let i=$(this),t=i.attr("data-new-girl-tooltip");if(!t)return;let e=t.match(/"name":"(.+)","rarity/);e&&e[1]&&(i.css("cursor","pointer"),i.on("click.ImgToWiki",function(s){s.stopPropagation();let o=e[1].replace(/ /g,"-");GM.openInTab(`https://harem-battle.club/wiki/Harem-Heroes/HH:${o}`,{active:!0})}))})}var d=class extends n{constructor(){let t={baseKey:"entirePaid",label:"Removes only $ options",default:!1};super(t)}shouldRun(){return!0}run(){this.hasRun||!this.shouldRun()||(this.hasRun=!0,GM.addStyle(".pass_reward.reward_wrapper{display:none!important;}"),GM.addStyle("#gsp_btn_holder{display:none!important;}"),GM.addStyle(".rewards_seasons_row .rewards_pair .tier_number{top:100%!important;}"),GM.addStyle("#get_mega_pass_shop_btn{display:none!important;}"),GM.addStyle("#bundles_tab{display:none!important;}"),GM.addStyle(".purchase-shop{display:none!important;}"))}};var S={baseKey:"tighterPoPs",label:"Tighter PoPs (requires css tweaks for PoP)",default:!0},m=class extends n{constructor(){super(S)}shouldRun(){return location.pathname.includes("/activities.html")}run(){this.hasRun||!this.shouldRun()||(this.hasRun=!0,GM.addStyle("#pop .pop_list .pop-action-btn {margin-bottom: 0.4rem!important;margin-top: 0rem!important;}#pop .pop_list .pop_list_scrolling_area .pop_thumb img {height: 90px!important;}.activities-container #pop .pop_list .pop_list_scrolling_area .pop_thumb_container .pop_thumb_expanded {height: 89px!important;background: linear-gradient(0deg, #00000087, transparent)!important;}.activities-container #pop .pop_list .pop_list_scrolling_area .pop_thumb_container, .activities-container #pop .pop_list .pop_list_scrolling_area .pop_thumb_container .pop_thumb_active {min-height: 89px!important;height: 89px!important;margin-bottom: 5px!important;}.activities-container #pop .pop_list .pop_list_scrolling_area .pop_thumb>.pop_thumb_level {top: -93px!important;}.activities-container #pop .pop_list .pop_list_scrolling_area .pop_thumb.pop_thumb_active[status=pending_reward]>.pop_thumb_space {top: -126px!important;}.activities-container #pop .pop_list .pop_list_scrolling_area .collect_notif {margin-top: -91px!important;margin-left: 121px!important;}.activities-container .pop_thumb_progress_bar {margin-top: 21px!important;}"))}};var h=class extends n{constructor(){super({baseKey:"labyTeamPreset",label:"Laby Team Preset",default:!0});this.savedTeamPresetKey="SeveralQoL_LabyTeamPreset"}shouldRun(){return location.pathname.includes("/edit-labyrinth-team.html")}run(){if(this.hasRun||!this.shouldRun())return;this.hasRun=!0;let e=$(".boss-bang-panel"),s=$(`<button class="green_button_L" tooltip="Use previously saved preset" ${localStorage.getItem(this.savedTeamPresetKey)?"":"disabled"}>Fill Preset</button>`);s.on("click",()=>{this.loadSavedPreset()}),e.append(s);let o=$('<button class="green_button_L" tooltip="Save preset for later runs">Save Preset</button>');o.on("click",()=>{this.saveCurrentPreset(),s.removeAttr("disabled")}),unsafeWindow.HHPlusPlus.Helpers.doWhenSelectorAvailable(".change-team-panel .player-team .average-lvl",()=>{$(".change-team-panel .player-team .average-lvl").replaceWith(o)})}saveCurrentPreset(){let e=[];$(".team-hexagon .team-member-container").each(function(){let s=$(this).attr("data-team-member-position"),o=$(this).attr("data-girl-id");$(this).is("[data-girl-id]")&&s&&o&&(e[s]=o)}),console.log("Saving preset: ",e),localStorage.setItem(this.savedTeamPresetKey,JSON.stringify(e))}loadSavedPreset(){let e=localStorage.getItem(this.savedTeamPresetKey);if(!e){console.warn("No saved preset found");return}try{let s=JSON.parse(e);console.log("Loading preset: ",s);let o={class:"Hero",action:"edit_team",girls:s,battle_type:"labyrinth",id_team:unsafeWindow.teamId};console.log("AJAX settings: ",o),shared.general.hh_ajax(o,r=>{shared.general.navigate(unsafeWindow.redirectUrl)})}catch(s){console.error("Failed to load preset:",s)}}};var g=class extends n{constructor(){let t={baseKey:"noAnnoyingPopups",label:"Removes popup appearing automaticly to pay for paths etc",default:!1};super(t)}shouldRun(){return!0}run(){this.hasRun||!this.shouldRun()||(document.cookie="disabledPopups=PassReminder; path=/")}};var _=class{constructor(){if(unsafeWindow.hhPlusPlusConfig===void 0){$(document).one("hh++-bdsm:loaded",()=>{this.initializeHHPlusPlus(),this.run()});return}this.initializeHHPlusPlus(),this.run()}initializeHHPlusPlus(){let{hhPlusPlusConfig:t}=unsafeWindow;this.hhPlusPlusConfig=t}run(){let t=[new u,new h,new g,new d,new c,new m];this.hhPlusPlusConfig.registerGroup({key:"severalQoL",name:"Several QoL"}),t.forEach(e=>{this.hhPlusPlusConfig.registerModule(e)}),this.hhPlusPlusConfig.loadConfig(),this.hhPlusPlusConfig.runModules()}};new _;})();
